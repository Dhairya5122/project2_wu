<!DOCTYPE html>
<html class="no-js" lang="">
  <meta http-equiv="content-type" content="text/html;charset=UTF-8" />
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>Dashboard Page</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="assets/css/normalize.css" />
    <link rel="stylesheet" href="assets/css/bootstrap.min.css" />
    <link rel="stylesheet" href="assets/css/font-awesome.min.css" />
    <link rel="stylesheet" href="assets/css/themify-icons.css" />
    <link rel="stylesheet" href="assets/css/pe-icon-7-filled.css" />
    <link rel="stylesheet" href="assets/css/flag-icon.min.css" />
    <link rel="stylesheet" href="assets/css/cs-skin-elastic.css" />
    <link rel="stylesheet" href="assets/css/style.css" />
    <link
      href="https://fonts.googleapis.com/css?family=Open+Sans:400,600,700,800"
      rel="stylesheet"
      type="text/css"
    />
  </head>
  <body>
    <aside id="left-panel" class="left-panel">
      <nav class="navbar navbar-expand-sm navbar-default">
        <div id="main-menu" class="main-menu collapse navbar-collapse">
          <ul class="nav navbar-nav">
            <li class="menu-title">Menu</li>
            <li class="menu-item-has-children dropdown">
              <a href="/admin/index"> User Master</a>
            </li>
            <li class="menu-item-has-children dropdown">
              <a href="/admin/product"> Product Master</a>
            </li>
            <li class="menu-item-has-children dropdown">
              <a href="/admin/category"> Category Master</a>
            </li>
          </ul>
        </div>
      </nav>
    </aside>
    <div id="right-panel" class="right-panel">
      <header id="header" class="header">
        <div class="top-left">
          <div class="navbar-header">
            <a class="navbar-brand" href="index.html"
              ><img src="images/logo.png" alt="Logo"
            /></a>
            <a class="navbar-brand hidden" href="index.html"
              ><img src="images/logo2.png" alt="Logo"
            /></a>
            <a id="menuToggle" class="menutoggle"><i class="fa fa-bars"></i></a>
          </div>
        </div>
        <div class="top-right">
          <div class="header-menu">
            <div class="user-area dropdown float-right">
              <a
                href="#"
                class="dropdown-toggle active"
                data-toggle="dropdown"
                aria-haspopup="true"
                aria-expanded="false"
                >Welcome Admin</a
              >
              <div class="user-menu dropdown-menu">
                <a class="nav-link" href="#"
                  ><i class="fa fa-power-off"></i>Logout</a
                >
              </div>
            </div>
          </div>
        </div>
      </header>
      <div class="content pb-0">
        <div class="orders">
          <div class="row">
            <div class="col-xl-12">
              <div class="card">
                <div class="card-body">
                  <h4 class="box-title">User Master</h4>
                </div>
                <div class="card-body--">
                  <div class="table-stats order-table ov-h">
                    <table class="table">
                      <thead>
                        <tr>
                          <th class="serial">#</th>
                          <th class="avatar">Avatar</th>
                          <th>ID</th>
                          <th>Name</th>
                          <th>Email</th>
                          <th>Status</th>
                          <th>Actions</th>
                        </tr>
                      </thead>
                      <tbody>
                        <!-- Sample row with data-user-id -->
                        <tr data-user-id="12345">
                          <td class="serial">1.</td>
                          <td class="avatar">
                            <div class="round-img">
                              <a href="#">
                                <img
                                  class="rounded-circle"
                                  src="images/avatar/1.jpg"
                                  alt="User Avatar"
                                />
                              </a>
                            </div>
                          </td>
                          <td>#12345</td>
                          <!-- Unique user ID -->
                          <td><span class="name">Louis Stanley</span></td>
                          <td>
                            <span class="name">louis.stanley@example.com</span>
                          </td>
                          <td>
                            <!-- User role: could be 'user' or 'admin' -->
                            <span class="badge" id="role-badge-12345"
                              >User</span
                            >
                          </td>
                          <td>
                            <!-- Admin-level actions -->
                            <a
                              href="#"
                              class="action-button active-button"
                              data-user-id="12345"
                            >
                              <span
                                id="status-badge-12345"
                                class="badge badge-complete"
                                >Active</span
                              >
                            </a>
                            <a
                              href="#"
                              class="action-button delete-button"
                              data-user-id="12345"
                            >
                              <span class="badge badge-danger">Delete</span>
                            </a>
                          </td>
                        </tr>
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="clearfix"></div>
      <footer class="site-footer">
        <div class="footer-inner bg-white">
          <div class="row">
            <div class="col-sm-6">Copyright &copy; 2018 Ela Admin</div>
            <div class="col-sm-6 text-right">
              Designed by <a href="https://colorlib.com/">Colorlib</a>
            </div>
          </div>
        </div>
      </footer>
    </div>
    <script
      src="assets/js/vendor/jquery-2.1.4.min.js"
      type="text/javascript"
    ></script>
    <script src="assets/js/popper.min.js" type="text/javascript"></script>
    <script src="assets/js/plugins.js" type="text/javascript"></script>
    <script src="assets/js/main.js" type="text/javascript"></script>

    <script>
      const baseUrl = "http://localhost:3000/api/users/";

      // Fetch all users with their roles and display them in a table
      async function fetchAllUsers() {
        const apiUrl = baseUrl; // Endpoint to fetch all users

        try {
          const response = await fetch(apiUrl);
          if (response.ok) {
            const users = await response.json();

            // Update the table with the fetched user data
            const tableBody = document.querySelector("tbody");
            tableBody.innerHTML = ""; // Clear existing content

            users.forEach((user, index) => {
              const row = document.createElement("tr");
              row.setAttribute("data-user-id", user._id);

              row.innerHTML = `
            <td class="serial">${index + 1}.</td>
            <td class="avatar">
              <div class="round-img">
                <a href="#">
                  <img
                    class="rounded-circle"
                    src="images/avatar/1.jpg"
                    alt="User Avatar"
                  />
                </a>
              </div>
            </td>
            <td>#${user._id}</td> <!-- Unique user ID -->
            <td><span class="name">${user.name}</span></td>
            <td><span class="name">${user.email}</span></td>
            <td><span class="badge badge-info">${
              user.role || "Unknown"
            }</span></td>
            <td>
              <a
                href="#"
                class="action-button delete-user-button"
                data-user-id="${user._id}"
                style="background-color: red; color: white;"
              >
                Delete
              </a>
            </td>
          `;

              tableBody.appendChild(row); // Add the row to the table
            });

            // Add event listeners to the delete buttons after fetching data
            addDeleteEventListeners();
          } else {
            console.error("Failed to fetch users:", response.statusText);
          }
        } catch (error) {
          console.error("Error while fetching users:", error);
        }
      }

      // Function to delete a user from the database
      async function deleteUser(userId) {
        const apiUrl = `${baseUrl}${userId}`;

        try {
          console.log(`Attempting to delete user with ID: ${userId}`);
          const response = await fetch(apiUrl, {
            method: "DELETE", // HTTP method for deletion
          });

          if (response.ok) {
            console.log("User successfully deleted");
            const row = document.querySelector(`tr[data-user-id="${userId}"]`);
            if (row) {
              row.remove(); // Remove the user from the table
            }
          } else {
            console.error("Failed to delete user:", response.statusText);
          }
        } catch (error) {
          console.error("Error while deleting user:", error);
        }
      }

      // Add event listeners to the delete buttons
      function addDeleteEventListeners() {
        const deleteUserButtons = document.querySelectorAll(
          ".delete-user-button"
        );

        deleteUserButtons.forEach((button) => {
          button.addEventListener("click", (event) => {
            event.preventDefault(); // Prevent default behavior
            const userId = button.getAttribute("data-user-id");

            // Confirmation dialog
            const confirmDelete = confirm(
              "Are you sure you want to delete this user?"
            );
            if (confirmDelete) {
              deleteUser(userId); // If confirmed, proceed with deletion
            }
          });
        });
      }

      // Fetch all users when the page loads
      document.addEventListener("DOMContentLoaded", fetchAllUsers);
    </script>
  </body>
</html>
